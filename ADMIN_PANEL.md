# Админ-панель - Тепло Арктики

## Обзор

Админ-панель предоставляет полный контроль над благотворительной платформой "Тепло Арктики". Все функции интегрированы с реальным API backend.

## Структура файлов

```
public/
├── admin/
│   ├── index.html       # Страница входа
│   ├── dashboard.html   # Управление транзакциями
│   ├── campaigns.html   # Управление сборами
│   └── reports.html     # Управление отчетами
└── js/
    └── admin.js         # Общие функции для админ-панели
```

## Функциональность

### 1. Страница входа (`/admin/`)

**Файл:** `public/admin/index.html`

**Функции:**
- Авторизация администратора по email и паролю
- Автоматическая проверка существующей сессии
- Безопасное хранение JWT токена
- Перенаправление в dashboard после успешного входа

**API Endpoint:** `POST /api/admin/login`

**Учетные данные по умолчанию:**
- Email: `admin@teplo-arctici.ru`
- Пароль: `admin123`

### 2. Управление транзакциями (`/admin/dashboard.html`)

**Функции:**
- Просмотр всех пожертвований с пагинацией (50 записей на страницу)
- Добавление транзакций вручную (для оффлайн пожертвований)
- Фильтрация и сортировка транзакций
- Экспорт данных в CSV
- Отображение общей суммы собранных средств
- Статусы транзакций: Исполнено, В обработке, Ошибка

**Поля формы добавления:**
- Сумма (обязательное)
- Целевой сбор (обязательное, выбор из списка)
- Email донора (опционально, если не анонимное)
- Анонимное пожертвование (чекбокс)

**API Endpoints:**
- `GET /api/admin/donations?page=1&limit=50` - Получить список транзакций
- `POST /api/admin/donations` - Создать новую транзакцию
- `GET /api/admin/campaigns` - Получить список сборов для селекта

### 3. Управление сборами (`/admin/campaigns.html`)

**Функции:**
- Просмотр всех благотворительных сборов (активных и неактивных)
- Создание новых сборов
- Редактирование существующих сборов
- Удаление сборов (с предупреждением о каскадном удалении)
- Визуализация прогресса каждого сбора
- Переключение статуса активности

**Поля формы сбора:**
- Название сбора (обязательное)
- Описание (обязательное, поддерживает многострочный текст)
- URL изображения баннера (опционально)
- Требуемая сумма (обязательное, в рублях)
- Статус активности (переключатель)
- Дата окончания (опционально)

**API Endpoints:**
- `GET /api/admin/campaigns` - Получить все сборы
- `POST /api/admin/campaigns` - Создать новый сбор
- `PUT /api/admin/campaigns/:id` - Обновить сбор
- `DELETE /api/admin/campaigns/:id` - Удалить сбор

### 4. Управление отчетами (`/admin/reports.html`)

**Функции:**
- Просмотр всех отчетов о расходах
- Создание новых отчетов о расходах
- Редактирование существующих отчетов
- Удаление отчетов
- Привязка отчетов к конкретным сборам
- Загрузка ссылок на документы/чеки

**Поля формы отчета:**
- Целевой сбор (обязательное, выбор из списка)
- Дата расхода (обязательное)
- Сумма расхода (обязательное, в рублях)
- Описание расхода (обязательное, подробное)
- Поставщик/Получатель (опционально)
- Ссылка на чек/документ (опционально, URL)

**API Endpoints:**
- `GET /api/admin/reports` - Получить все отчеты
- `POST /api/admin/reports` - Создать новый отчет
- `PUT /api/admin/reports/:id` - Обновить отчет
- `DELETE /api/admin/reports/:id` - Удалить отчет

## Общие функции (`admin.js`)

### Класс AdminAPI

Предоставляет методы для работы с API:

```javascript
// Авторизация
await api.login(email, password)
await api.verifyToken()
api.logout()

// Транзакции
await api.getDonations(page, limit)
await api.createDonation(data)

// Сборы
await api.getCampaigns()
await api.createCampaign(data)
await api.updateCampaign(id, data)
await api.deleteCampaign(id)

// Отчеты
await api.getReports()
await api.createReport(data)
await api.updateReport(id, data)
await api.deleteReport(id)
```

### Утилиты TokenManager

Управление JWT токеном:

```javascript
TokenManager.get()           // Получить токен
TokenManager.set(token)      // Сохранить токен
TokenManager.remove()        // Удалить токен
TokenManager.getAdminData()  // Получить данные администратора
TokenManager.setAdminData(data) // Сохранить данные администратора
```

### Утилиты UI

Вспомогательные функции для интерфейса:

```javascript
UI.showNotification(message, type)  // Показать уведомление
UI.showError(message)               // Показать ошибку
UI.formatAmount(amount)             // Форматировать сумму
UI.formatDate(dateString)           // Форматировать дату
UI.formatDateTime(dateString)       // Форматировать дату и время
UI.getStatusBadge(status)           // Получить HTML статус-бейдж
```

### Функция checkAuth()

Проверяет авторизацию на всех защищенных страницах. Автоматически перенаправляет неавторизованных пользователей на страницу входа.

```javascript
// Использование в каждой странице админ-панели
const isAuth = await checkAuth();
if (!isAuth) return;
```

## Безопасность

### JWT Токены

- Токены действительны 24 часа
- Токены хранятся в localStorage
- Автоматическая проверка токена при каждом запросе
- При ошибке 401 автоматическое перенаправление на страницу входа

### Rate Limiting

- Login endpoint: 5 запросов в 15 минут
- Admin API: 100 запросов в 15 минут
- Защита от brute-force атак

### Валидация данных

- Все входные данные валидируются на backend
- Обязательные поля проверяются на frontend
- Email валидация
- Валидация числовых полей (суммы, даты)

## Дизайн

### Цветовая схема

- Primary: `#137fec` (голубой)
- Background Light: `#f6f7f8`
- Background Dark: `#101922`

### Темная тема

Все страницы поддерживают переключение между светлой и темной темой. Настройка сохраняется в localStorage.

### Адаптивность

Все страницы полностью адаптивны и корректно отображаются на:
- Desktop (1920px+)
- Laptop (1280px+)
- Tablet (768px+)
- Mobile (320px+)

## Уведомления

Система уведомлений информирует о результатах операций:

- **Зеленые** - успешные операции
- **Красные** - ошибки и предупреждения
- Автоматическое скрытие через 3 секунды
- Анимированное появление/исчезновение

## Навигация

### Sidebar

Фиксированная боковая панель с навигацией:
- Транзакции (dashboard.html)
- Управление сборами (campaigns.html)
- Отчеты (reports.html)
- Выход (logout)

### Breadcrumbs

Хлебные крошки на страницах создания/редактирования для удобной навигации.

## Пагинация

### Транзакции

- 50 записей на страницу
- Навигация по страницам
- Отображение общего количества записей
- Быстрый переход к первой/последней странице

## Экспорт данных

### CSV Export (Транзакции)

Кнопка "Экспорт CSV" на странице транзакций экспортирует все данные:
- Дата транзакции
- Email донора
- Название сбора
- Сумма
- Статус
- Способ оплаты

Формат: UTF-8 с BOM для корректного отображения в Excel.

## Модальные окна

Используются для:
- Создания отчетов
- Редактирования отчетов
- Подтверждения удаления

Закрываются по:
- Клику на кнопку "Закрыть"
- Клику на кнопку "Отмена"
- Клику на затемненный фон
- Нажатию ESC (в будущем)

## Тестовые данные

После инициализации базы данных доступны тестовые данные:
- 3 благотворительных сбора
- 10+ транзакций
- Несколько отчетов о расходах

## Запуск

1. Убедитесь, что backend сервер запущен:
   ```bash
   cd backend
   npm start
   ```

2. Откройте браузер и перейдите:
   ```
   http://localhost:3000/admin/
   ```

3. Войдите с учетными данными администратора

## Поддержка браузеров

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## Известные ограничения

1. **Загрузка файлов**: В текущей версии нет встроенной загрузки файлов. Для изображений и документов необходимо использовать внешние URL.

2. **Поиск**: Функция поиска по транзакциям и сборам будет добавлена в следующих версиях.

3. **Уведомления в реальном времени**: WebSocket уведомления о новых транзакциях будут добавлены позже.

## Roadmap

- [ ] Загрузка файлов на сервер
- [ ] Расширенные фильтры и поиск
- [ ] WebSocket уведомления
- [ ] Детальная аналитика и графики
- [ ] Экспорт в PDF
- [ ] Настройки системы
- [ ] Управление пользователями
- [ ] Логи действий администраторов
